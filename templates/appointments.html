<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡∏±‡∏î & ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ß‡∏£</title>

  <!-- ‡πÉ‡∏ä‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ö‡∏≤‡∏á/‡∏õ‡∏Å‡∏ï‡∏¥/‡∏Å‡∏∂‡πà‡∏á‡∏´‡∏ô‡∏≤ (‡∏ï‡∏±‡∏î‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏≤‡∏≠‡∏≠‡∏Å) -->
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500&display=swap" rel="stylesheet">

  <style>
    :root{
      --teal:#0f766e; --teal-600:#0d9488;
      --bg:#f7faf9; --card:#ffffff;

      /* ‡πÄ‡∏™‡πâ‡∏ô‡∏ö‡∏≤‡∏á‡πÜ ‡πÇ‡∏ó‡∏ô‡∏≠‡πà‡∏≠‡∏ô */
      --line:#eef2f7;
      --grid:#eef2f7;
      --grid-soft:#f6f8fb;
      --hover:#f8fafc;

      --text:#0f172a; --muted:#6b7280;

      /* ‡πÄ‡∏á‡∏≤‡πÄ‡∏ö‡∏≤‡∏•‡∏á */
      --shadow:0 6px 16px rgba(2,8,23,.05);
      --radius:16px;
    }

    *{box-sizing:border-box}
    body{
      font-family:'Prompt','Segoe UI',sans-serif;
      margin:0;
      background:var(--bg);
      color:var(--text);
      padding:10px 10px 120px;
      font-size:12px;
      font-weight:400;
      -webkit-text-size-adjust:100%;
      text-size-adjust:100%;
    }
    strong,b{font-weight:500}

    /* ‡πÉ‡∏´‡πâ ‚Äú‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‚Äù ‡∏à‡∏£‡∏¥‡∏á */
    .container{
      width:100%;
      max-width:980px;       /* ‡πÄ‡∏î‡∏™‡∏Å‡πå‡∏ó‡πá‡∏≠‡∏õ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏ú‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ */
      margin:10px auto;
      background:#fff;
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
      overflow:hidden;
    }

    .headline{font-size:18px;font-weight:500;color:#0b7660;margin:0 0 6px}
    .sub-muted{color:var(--muted);font-size:12px;margin-top:-2px;line-height:1.35}

    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .chip{
      padding:8px 12px;border:1px solid #cfeeea;border-radius:999px;
      background:#fff;color:#0b7660;font-size:12px;cursor:pointer;
      font-weight:400;user-select:none;
    }
    .chip.active{background:#0b7660;color:#fff;border-color:#0b7660}

    .panel{display:none}
    .panel.active{display:block}

    .card{background:#fff;border:1px solid var(--line);border-radius:14px;padding:12px}
    .section{margin:12px 0 16px}

    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:6px;
      padding:10px 12px;border-radius:10px;border:1px solid #cfeeea;background:#fff;color:#0b7660;
      cursor:pointer;font-weight:500;font-size:12px;
      -webkit-tap-highlight-color:transparent;
    }
    .btn-primary{border-color:transparent;background:var(--teal-600);color:#fff}
    .btn-ghost{background:#f5f7fb;border-color:var(--line);color:#0f172a}

    .ipt{
      width:100%;
      padding:10px 12px;
      border:1px solid #dde3ea;
      border-radius:10px;
      background:#fff;
      font-size:13px;
      font-family:inherit;
      font-weight:400;
      -webkit-appearance:none;appearance:none;
    }

    /* =========================
       DAILY: ‡∏Ñ‡∏•‡∏µ‡∏ô ‡πÄ‡∏™‡πâ‡∏ô‡∏ö‡∏≤‡∏á
       ========================= */
    .paperWrap{
      border:1px solid var(--grid);
      border-radius:14px;
      overflow:hidden;
      background:#fff;
    }
    .paperHeader{
      display:flex;justify-content:space-between;align-items:flex-end;gap:10px;flex-wrap:wrap;
      padding:12px 12px 10px;
      border-bottom:1px solid var(--grid);
      background:linear-gradient(180deg, #ffffff 0%, #fbfffe 100%);
    }
    .paperHeader .left{
      display:flex;gap:10px;align-items:flex-end;flex-wrap:wrap;
      font-weight:500;color:#0f172a;
    }
    .paperTitle{
      font-weight:500;font-size:13px;color:#0b3d35;margin-right:4px;
    }
    .lineField{
      display:inline-flex;align-items:flex-end;gap:6px;white-space:nowrap;
      font-size:12px;color:#0f172a;font-weight:400;
    }
    .line{
      display:inline-block;
      min-width:86px;
      border-bottom:1px dotted #aab6c5;
      padding:0 6px 2px;
      font-weight:500;
      text-align:center;
      color:#0f172a;
    }
    .line.small{min-width:60px}
    .line.medium{min-width:110px}

    .paperControls{
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;
      margin-top:10px;
    }
    .paperControls .group{
      display:flex;gap:8px;flex-wrap:wrap;align-items:center;
    }

    .tableScroll{
      overflow:auto;
      -webkit-overflow-scrolling:touch;
      overscroll-behavior:contain;
    }
    table.clean{
      width:100%;
      min-width:820px; /* ‡πÄ‡∏î‡∏™‡∏Å‡πå‡∏ó‡πá‡∏≠‡∏õ */
      border-collapse:separate;
      border-spacing:0;
      background:#fff;
    }
    table.clean thead th{
      position:sticky; top:0;
      background:#f8fafc;
      z-index:1;
      text-align:center;
      font-weight:500;
      font-size:12px;
      padding:10px 8px;
      border-bottom:1px solid var(--grid);
    }
    table.clean th, table.clean td{
      border-right:1px solid var(--grid);
    }
    table.clean thead th:last-child,
    table.clean tbody td:last-child{border-right:none}

    table.clean tbody td{
      border-bottom:1px solid var(--grid);
      padding:8px;
      vertical-align:top;
      background:#fff;
    }
    table.clean tbody tr:nth-child(even) td{
      background:#fcfcfd;
    }
    .timeCell{
      width:90px;
      text-align:center;
      font-weight:500;
      color:#0f172a;
      background:#fbfffe !important;
    }

    /* ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á: ‡∏ó‡∏±‡πâ‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ */
    .slotEmpty{
      width:100%;
      min-height:34px;
      border:1px solid transparent;
      border-radius:12px;
      padding:8px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      color:#94a3b8;
      font-weight:400;
      font-size:11px;
      user-select:none;
    }
    .slotEmpty:hover{
      background:var(--hover);
      border-color:#e6edf5;
      color:#64748b;
    }
    .slotEmpty.noText{color:transparent}
    .slotEmpty.noText::after{
      content:'';
      display:block;
      width:100%;
      height:18px;
    }

    /* ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ô‡∏±‡∏î */
    .apptCard{
      border-radius:14px;
      padding:8px 10px;
      border:1px solid rgba(15,23,42,.10);
      box-shadow:0 10px 20px rgba(2,8,23,.06);
      display:grid; gap:2px;
      cursor:pointer;
    }
    .apptCard .name{font-weight:500;font-size:13px}
    .apptCard .meta{font-size:11px;color:#334155;opacity:.85;font-weight:400}
    .apptCard .foot{display:flex;justify-content:space-between;align-items:center;margin-top:4px}
    .tag{
      display:inline-flex;align-items:center;gap:6px;
      padding:4px 8px;border-radius:999px;font-size:10px;font-weight:500;
      border:1px solid rgba(0,0,0,.06);
      background:rgba(255,255,255,.7);
    }
    .dot{width:8px;height:8px;border-radius:999px}
    .old{background:#ecfdf5;border-color:#a7f3d0;color:#065f46}
    .old .dot{background:#22c55e}
    .guest{background:#fffbeb;border-color:#fde68a;color:#92400e}
    .guest .dot{background:#f59e0b}

    /* =========================
       MONTHLY (iOS-style) ‡∏•‡∏î‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏≤ + ‡πÄ‡∏™‡πâ‡∏ô‡∏ö‡∏≤‡∏á
       ========================= */
    .iosMonthHeader{
      display:flex;align-items:flex-end;justify-content:space-between;gap:10px;flex-wrap:wrap;
      padding:6px 2px 10px;
    }
    .iosMonthHeader .monthTitle{font-size:28px;font-weight:500;letter-spacing:.2px}
    .iosMonthHeader .todayBtn{font-weight:500;color:#ef4444;cursor:pointer;user-select:none}

    .iosWeekHead{
      display:grid;grid-template-columns:repeat(7,1fr);
      border-top:1px solid var(--grid);border-bottom:1px solid var(--grid);
      padding:8px 0;margin-top:6px;
      color:#94a3b8;font-weight:500;font-size:12px;text-align:center;
    }
    .iosGrid{
      display:grid;
      grid-template-columns:repeat(7,1fr);
      border-bottom:1px solid var(--grid);
    }
    .iosDay{
      min-height:110px;
      border-right:1px solid var(--grid);
      border-top:1px solid var(--grid);
      padding:8px 8px 10px;
      background:#fff;
      overflow:hidden;
    }
    .iosDay:nth-child(7n){border-right:none}
    .iosDay .num{font-weight:500;font-size:16px;color:#0f172a}
    .iosDay.muted .num{color:#cbd5e1}
    .iosDay .events{display:flex;flex-direction:column;gap:6px;margin-top:8px}

    .eventPill{
      display:flex;align-items:center;gap:6px;
      padding:6px 8px;border-radius:8px;
      font-weight:500;font-size:12px;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
    .ev-green{background:#d9f2cc;color:#1f5e2b}
    .ev-purple{background:#e9d5ff;color:#6b21a8}
    .ev-blue{background:#cfe8ff;color:#0b4b7a}
    .ev-brown{background:#ead8c5;color:#5a3a1a}
    .eventPill .icon{
      width:14px;height:14px;border-radius:4px;
      display:inline-flex;align-items:center;justify-content:center;
      font-size:10px;background:rgba(0,0,0,.12);flex:0 0 auto;
    }

    /* =========================
       MODAL
       ========================= */
    .modal{
      display:none;
      position:fixed; inset:0;
      background:rgba(0,0,0,.45);
      z-index:9999;
      align-items:flex-end;
      justify-content:center;
      padding:10px;
    }
    .modal.show{display:flex}
    .modal .box{
      width:min(520px, 100%);
      background:#fff;
      border-radius:16px;
      overflow:hidden;
      box-shadow:0 12px 26px rgba(0,0,0,.16);
      border:1px solid rgba(255,255,255,.25);
    }
    .modal .hdr{
      background:#e0f2f1;
      color:#004d40;
      display:flex;align-items:center;justify-content:space-between;
      padding:12px 14px;
      font-weight:500;
      font-size:13px;
    }
    .modal .close{background:transparent;border:none;font-size:18px;cursor:pointer;color:#004d40}
    .modal .body{padding:14px; display:grid; gap:10px}
    .modal .ftr{
      padding:12px 14px;
      border-top:1px solid var(--line);
      display:flex; justify-content:flex-end; gap:8px;
    }

    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}

    /* =========================
       MOBILE: ‡∏ó‡∏≥‡πÉ‡∏´‡πâ "‡πÑ‡∏°‡πà‡πÉ‡∏´‡∏ç‡πà‡πÑ‡∏õ" + ‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ + ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏á‡πà‡∏≤‡∏¢
       ========================= */
    @media (max-width:640px){
      body{
        padding:8px 8px 110px;
        font-size:11.5px;
      }
      .container{
        max-width:100%;
        margin:8px auto;
        padding:10px;
        border-radius:14px;
      }

      .headline{font-size:16px}
      .sub-muted{font-size:11px}

      .btn{padding:9px 10px;font-size:11.5px;border-radius:10px}
      .ipt{padding:9px 10px;font-size:12.5px}

      /* ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡∏Ç‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏î‡∏π ‚Äú‡πÉ‡∏´‡∏ç‡πà‚Äù */
      table.clean{min-width:680px}
      table.clean thead th{padding:9px 6px;font-size:11.5px}
      table.clean tbody td{padding:7px}

      .timeCell{width:72px}

      .apptCard{padding:7px 9px}
      .apptCard .name{font-size:12.5px}
      .apptCard .meta{font-size:10.5px}
      .tag{font-size:9.5px}

      .slotEmpty{min-height:30px;font-size:10.5px}

      .iosMonthHeader .monthTitle{font-size:24px}
      .iosDay{min-height:96px;padding:7px 7px 9px}
      .iosDay .num{font-size:15px}
      .eventPill{font-size:11.5px;padding:6px 7px}

      .line{min-width:74px}
      .line.medium{min-width:92px}
      .grid2{grid-template-columns:1fr}
    }
  </style>
</head>

<body>

  <div class="container">
    <div class="headline">‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢ & ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ß‡∏£</div>
    <div class="sub-muted">
      UI ‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏ï‡∏≤ ‡πÄ‡∏™‡πâ‡∏ô‡∏ö‡∏≤‡∏á ‡πÑ‡∏°‡πà‡∏£‡∏Å | ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏î‡πÑ‡∏î‡πâ | ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏£‡∏¥‡∏á‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (LocalStorage)
    </div>

    <div class="chips">
      <span class="chip active" data-tab="daily">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡∏±‡∏î‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</span>
      <span class="chip" data-tab="monthly">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ß‡∏£‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
      <span class="chip" data-tab="settings">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
    </div>

    <!-- ================= TAB: DAILY ================= -->
    <div class="panel active" id="panel-daily">
      <div class="section">

        <div class="paperControls">
          <div class="group">
            <div style="font-weight:500;color:#0b3d35">Daily Schedule</div>
            <button class="btn btn-ghost" type="button" onclick="UI.dailyToday()">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
          </div>
          <div class="group" style="min-width:240px;flex:1;justify-content:flex-end">
            <input class="ipt" style="max-width:220px" type="date" id="dailyDate">
            <button class="btn btn-primary" type="button" onclick="UI.openApptModal()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏î</button>
          </div>
        </div>

        <div class="paperWrap" style="margin-top:10px;">
          <div class="paperHeader">
            <div class="left">
              <span class="paperTitle">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡∏±‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</span>
              <span class="lineField">‡∏ß‡∏±‡∏ô <span class="line small" id="hdrDay">‡∏®‡∏∏‡∏Å‡∏£‡πå</span></span>
              <span class="lineField">‡∏ó‡∏µ‡πà <span class="line small" id="hdrDateNum">2</span></span>
              <span class="lineField">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô <span class="line medium" id="hdrMonth">‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°</span></span>
            </div>
            <div class="right">
              <span class="lineField">‡∏´‡∏°‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡∏•‡∏≤ <span class="line small" id="hdrDoctorTime">11:00</span></span>
            </div>
          </div>

          <div class="tableScroll">
            <table class="clean" id="dailyTable">
              <thead>
                <tr>
                  <th style="width:90px">‡πÄ‡∏ß‡∏•‡∏≤</th>
                  <th>‡πÄ‡∏Ñ‡∏™‡πÅ‡∏û‡∏ó‡∏¢‡πå</th>
                  <th>‡πÄ‡∏Ñ‡∏™‡πÅ‡∏û‡∏ó‡∏¢‡πå</th>
                  <th>‡πÄ‡∏Ñ‡∏™‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•<br><span style="font-weight:400;font-size:11px;color:#64748b">Treatment</span></th>
                  <th>‡πÄ‡∏Ñ‡∏™‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•<br><span style="font-weight:400;font-size:11px;color:#64748b">IV, PRP</span></th>
                </tr>
              </thead>
              <tbody id="dailyBody"></tbody>
            </table>
          </div>
        </div>

      </div>
    </div>

    <!-- ================= TAB: MONTHLY ================= -->
    <div class="panel" id="panel-monthly">
      <div class="section card">
        <div class="iosMonthHeader">
          <div class="monthTitle" id="monthTitle">‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏° 2568</div>
          <div class="todayBtn" onclick="UI.monthToday()">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
        </div>

        <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:space-between;align-items:center">
          <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
            <input class="ipt" style="max-width:200px" type="month" id="monthPicker">
            <button class="btn btn-ghost" type="button" onclick="UI.renderMonth()">‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
          </div>
          <button class="btn btn-primary" type="button" onclick="UI.copyWeekMock()">Copy ‡πÄ‡∏ß‡∏£</button>
        </div>

        <div class="iosWeekHead">
          <div>‡∏≠‡∏≤.</div><div>‡∏à.</div><div>‡∏≠.</div><div>‡∏û.</div><div>‡∏û‡∏§.</div><div>‡∏®.</div><div>‡∏™.</div>
        </div>

        <div class="iosGrid" id="iosGrid"></div>
      </div>
    </div>

    <!-- ================= TAB: SETTINGS ================= -->
    <div class="panel" id="panel-settings">
      <div class="section card">
        <div style="font-weight:500;color:#0b3d35;margin-bottom:8px">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ (placeholder)</div>
        <div class="sub-muted">‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á</div>
      </div>
    </div>

  </div><!-- /container -->

  <!-- ================= Modal: ‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢ ================= -->
  <div class="modal" id="apptModal" onclick="UI.closeOnBackdrop(event,'apptModal')">
    <div class="box" onclick="event.stopPropagation()">
      <div class="hdr">
        <div>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</div>
        <button class="close" onclick="UI.closeModal('apptModal')">‚úï</button>
      </div>

      <div class="body">
        <div class="sub-muted" style="font-size:11px">
          ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (LocalStorage) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ Supabase ‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á
        </div>

        <div>
          <label style="font-weight:500;color:#334155;font-size:12px;margin:2px 0 4px;display:block">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
          <select class="ipt" id="apptType">
            <option value="existing">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Å‡πà‡∏≤ (Existing)</option>
            <option value="guest">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà (Guest / Walk-in)</option>
          </select>
        </div>

        <div id="existingBox">
          <label style="font-weight:500;color:#334155;font-size:12px;margin:2px 0 4px;display:block">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡∏ä‡∏∑‡πà‡∏≠/‡πÄ‡∏ö‡∏≠‡∏£‡πå)</label>
          <input class="ipt" id="custSearch" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡∏π‡∏Å‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤)">
          <div class="sub-muted" style="font-size:11px">‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡∏ú‡∏π‡∏Å‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡∏à‡∏∞‡∏¢‡∏¥‡∏á‡πÑ‡∏õ /api/customers ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏≥ autocomplete ‡πÑ‡∏î‡πâ</div>
        </div>

        <div id="guestBox" style="display:none">
          <label style="font-weight:500;color:#334155;font-size:12px;margin:2px 0 4px;display:block">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</label>
          <input class="ipt" id="guestName" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠">
          <label style="font-weight:500;color:#334155;font-size:12px;margin:10px 0 4px;display:block">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
          <input class="ipt" id="guestPhone" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå">
        </div>

        <div class="grid2">
          <div>
            <label style="font-weight:500;color:#334155;font-size:12px;margin:2px 0 4px;display:block">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î</label>
            <input type="date" class="ipt" id="apptDate">
          </div>
          <div>
            <label style="font-weight:500;color:#334155;font-size:12px;margin:2px 0 4px;display:block">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°</label>
            <input type="time" class="ipt" id="apptTime" value="11:00">
          </div>
        </div>

        <div class="grid2">
          <div>
            <label style="font-weight:500;color:#334155;font-size:12px;margin:2px 0 4px;display:block">‡∏•‡∏á‡∏ä‡πà‡∏≠‡∏á</label>
            <select class="ipt" id="apptCol">
              <option value="1">‡πÄ‡∏Ñ‡∏™‡πÅ‡∏û‡∏ó‡∏¢‡πå (1)</option>
              <option value="2">‡πÄ‡∏Ñ‡∏™‡πÅ‡∏û‡∏ó‡∏¢‡πå (2)</option>
              <option value="3">‡πÄ‡∏Ñ‡∏™‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• (Treatment)</option>
              <option value="4">‡πÄ‡∏Ñ‡∏™‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• (IV, PRP)</option>
            </select>
          </div>
          <div>
            <label style="font-weight:500;color:#334155;font-size:12px;margin:2px 0 4px;display:block">‡∏´‡∏±‡∏ï‡∏ñ‡∏Å‡∏≤‡∏£/‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</label>
            <input class="ipt" id="apptService" placeholder="‡πÄ‡∏ä‡πà‡∏ô Botox / IV / Consult">
          </div>
        </div>

        <div>
          <label style="font-weight:500;color:#334155;font-size:12px;margin:2px 0 4px;display:block">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
          <textarea class="ipt" id="apptNote" rows="3" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏ô‡πâ‡∏ï..."></textarea>
        </div>
      </div>

      <div class="ftr">
        <button class="btn btn-ghost" type="button" onclick="UI.closeModal('apptModal')">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button class="btn btn-primary" type="button" onclick="UI.saveApptMock()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </div>
    </div>
  </div>

  <script>
    // ---------------- Helpers ----------------
    function pad2(n){ return String(n).padStart(2,'0'); }
    function toHHMM(mins){
      const h=Math.floor(mins/60), m=mins%60;
      return `${pad2(h)}:${pad2(m)}`;
    }
    function escapeHtml(s){
      return String(s ?? '')
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'","&#039;");
    }
    function uuid(){
      try{
        if (crypto && typeof crypto.randomUUID === 'function') return crypto.randomUUID();
      }catch(_){}
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }

    // =========================
    // Appointments Store (LocalStorage)
    // =========================
    const ApptStore = {
      key: 'CLINIC_APPTS_V1',

      _load(){
        try{
          const raw = localStorage.getItem(this.key);
          const arr = raw ? JSON.parse(raw) : [];
          return Array.isArray(arr) ? arr : [];
        }catch(_){
          return [];
        }
      },

      _save(arr){
        localStorage.setItem(this.key, JSON.stringify(arr));
      },

      listByDate(date){
        const arr = this._load();
        return arr
          .filter(a => a && a.date === date)
          .sort((a,b) => (a.time||'').localeCompare(b.time||''));
      },

      upsert(appt){
        const arr = this._load();
        const i = arr.findIndex(x => x.id === appt.id);
        if(i >= 0) arr[i] = appt;
        else arr.push(appt);
        this._save(arr);
      },

      remove(id){
        const arr = this._load().filter(x => x.id !== id);
        this._save(arr);
      }
    };

    function apptClass(type){
      return type === 'guest' ? 'guest' : 'old';
    }
    function apptTypeLabel(type){
      return type === 'guest' ? '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà' : '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Å‡πà‡∏≤';
    }

    // ---------------- Tabs + UI ----------------
    const UI = {
      _editingApptId: null,

      goto(tab){
        document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
        document.querySelector(`.chip[data-tab="${tab}"]`)?.classList.add('active');

        document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
        document.getElementById(`panel-${tab}`)?.classList.add('active');
      },
      openModal(id){ document.getElementById(id)?.classList.add('show'); },
      closeModal(id){
        document.getElementById(id)?.classList.remove('show');
        if(id === 'apptModal') UI._editingApptId = null;
      },
      closeOnBackdrop(e,id){ if(e.target && e.target.id===id) UI.closeModal(id); },

      _syncModalFooterButtons(){
        const ftr = document.querySelector('#apptModal .ftr');
        if(!ftr) return;

        const delBtn = UI._editingApptId
          ? `<button class="btn" type="button" style="border-color:#fecaca;color:#b91c1c;background:#fff" onclick="UI.deleteEditingAppt()">‡∏•‡∏ö</button>`
          : ``;

        const saveText = UI._editingApptId ? '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç' : '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';

        ftr.innerHTML = `
          <button class="btn btn-ghost" type="button" onclick="UI.closeModal('apptModal')">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          ${delBtn}
          <button class="btn btn-primary" type="button" onclick="UI.saveApptMock()">${saveText}</button>
        `;
      },

      deleteEditingAppt(){
        if(!UI._editingApptId) return;
        if(!confirm('‡∏•‡∏ö‡∏ô‡∏±‡∏î‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?')) return;
        ApptStore.remove(UI._editingApptId);
        UI._editingApptId = null;
        UI.closeModal('apptModal');
        renderDailyTable();
      },

      openApptModal(prefill={}){
        UI._editingApptId = prefill.id || null;

        const d = prefill.date || document.getElementById('dailyDate')?.value || new Date().toISOString().slice(0,10);
        document.getElementById('apptDate').value = d;

        document.getElementById('apptTime').value = prefill.time || document.getElementById('apptTime').value || '11:00';
        document.getElementById('apptCol').value  = String(prefill.col || document.getElementById('apptCol').value || '1');

        document.getElementById('apptType').value = prefill.type || 'existing';
        document.getElementById('existingBox').style.display = (document.getElementById('apptType').value==='existing') ? '' : 'none';
        document.getElementById('guestBox').style.display = (document.getElementById('apptType').value==='guest') ? '' : 'none';

        document.getElementById('custSearch').value = (prefill.type === 'existing') ? (prefill.name || '') : '';
        document.getElementById('guestName').value  = (prefill.type === 'guest') ? (prefill.name || '') : '';
        document.getElementById('guestPhone').value = (prefill.type === 'guest') ? (prefill.phone || '') : '';

        document.getElementById('apptService').value = prefill.service || '';
        document.getElementById('apptNote').value    = prefill.note || '';

        UI.openModal('apptModal');
        UI._syncModalFooterButtons();
      },

      saveApptMock(){
        try{
          const type = document.getElementById('apptType').value;

          const date = (document.getElementById('apptDate').value || '').trim();
          const time = (document.getElementById('apptTime').value || '').trim();
          const col  = parseInt(document.getElementById('apptCol').value || '1', 10);

          const service = (document.getElementById('apptService').value || '').trim();
          const note    = (document.getElementById('apptNote').value || '').trim();

          let name = '';
          let phone = '';

          if(type === 'guest'){
            name  = (document.getElementById('guestName').value || '').trim();
            phone = (document.getElementById('guestPhone').value || '').trim();
          }else{
            name = (document.getElementById('custSearch').value || '').trim();
            phone = '';
          }

          if(!date) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î');
          if(!time) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤');
          if(!name) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠/‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤');

          const appt = {
            id: UI._editingApptId || uuid(),
            date, time, col,
            type, name, phone,
            service, note,
            status: 'PENDING',
            updatedAt: new Date().toISOString()
          };

          ApptStore.upsert(appt);

          UI.closeModal('apptModal');
          renderDailyTable();
        }catch(e){
          console.error(e);
          alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        }
      },

      dailyToday(){
        const d = new Date();
        const ymd = d.toISOString().slice(0,10);
        document.getElementById('dailyDate').value = ymd;
        applyDailyHeaderFromDate(ymd);
        renderDailyTable();
      },
      monthToday(){
        const d = new Date();
        document.getElementById('monthPicker').value = d.toISOString().slice(0,7);
        UI.renderMonth();
      },
      copyWeekMock(){ alert('Copy ‡πÄ‡∏ß‡∏£ (‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ú‡∏π‡∏Å API)'); },

      renderMonth(){ renderIOSCalendar(); }
    };

    document.querySelectorAll('.chip[data-tab]').forEach(ch=>{
      ch.addEventListener('click', ()=>UI.goto(ch.getAttribute('data-tab')));
    });

    // ---------------- Modal type switch ----------------
    const apptType = document.getElementById('apptType');
    apptType.addEventListener('change', ()=>{
      const v = apptType.value;
      document.getElementById('existingBox').style.display = (v==='existing') ? '' : 'none';
      document.getElementById('guestBox').style.display = (v==='guest') ? '' : 'none';
      UI._syncModalFooterButtons();
    });

    // ---------------- Daily Table ----------------
    function renderDailyTable(){
      const tbody = document.getElementById('dailyBody');
      tbody.innerHTML='';

      const dateSel = document.getElementById('dailyDate')?.value || new Date().toISOString().slice(0,10);
      const appts = ApptStore.listByDate(dateSel);

      const start = 11*60;
      const end   = 19*60;
      const step  = 30;

      for(let t=start; t<=end; t+=step){
        const tr=document.createElement('tr');

        const tdTime=document.createElement('td');
        tdTime.className='timeCell';
        tdTime.textContent = toHHMM(t).replace(':','.');
        tr.appendChild(tdTime);

        for(let col=1; col<=4; col++){
          const td=document.createElement('td');

          const found = appts.find(a => (a.time === toHHMM(t)) && (Number(a.col) === Number(col)));

          if(found){
            td.innerHTML = `
              <div class="apptCard ${apptClass(found.type)}">
                <div class="name">${escapeHtml(found.name || '')}</div>
                <div class="meta">${escapeHtml(found.service || '‚Äî')} ‚Ä¢ ${escapeHtml(found.status || 'PENDING')}</div>
                <div class="foot">
                  <span class="tag ${apptClass(found.type)}"><span class="dot"></span>${apptTypeLabel(found.type)}</span>
                  <span style="font-size:11px;font-weight:400;opacity:.85">${escapeHtml(found.phone || '')}</span>
                </div>
              </div>
            `;
            td.querySelector('.apptCard')?.addEventListener('click', (e)=>{
              e.stopPropagation();
              UI.openApptModal(found);
            });
          }else{
            const empty=document.createElement('div');
            empty.className='slotEmpty';
            empty.textContent='';
            empty.onclick=()=>UI.openApptModal({
              time: toHHMM(t),
              col,
              date: document.getElementById('dailyDate').value
            });
            td.appendChild(empty);
          }

          tr.appendChild(td);
        }

        tbody.appendChild(tr);
      }
    }

    // ---------------- Daily header ----------------
    const TH_DAYS = ['‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå','‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå','‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£','‡∏û‡∏∏‡∏ò','‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ','‡∏®‡∏∏‡∏Å‡∏£‡πå','‡πÄ‡∏™‡∏≤‡∏£‡πå'];
    const TH_MONTHS = ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå','‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°','‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô','‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°','‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô','‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°','‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô','‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°','‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô','‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];

    function applyDailyHeaderFromDate(ymd){
      if(!ymd) return;
      const d = new Date(ymd + 'T00:00:00');
      if(isNaN(d)) return;

      document.getElementById('hdrDay').textContent = TH_DAYS[d.getDay()];
      document.getElementById('hdrDateNum').textContent = String(d.getDate());
      document.getElementById('hdrMonth').textContent = TH_MONTHS[d.getMonth()];
      document.getElementById('hdrDoctorTime').textContent = '11:00';
    }

    // ---------------- Monthly calendar (‡πÄ‡∏î‡∏¥‡∏°) ----------------
    function thYear(y){ return y + 543; }
    function renderIOSCalendar(){
      const grid = document.getElementById('iosGrid');
      grid.innerHTML='';

      const mp = document.getElementById('monthPicker');
      const ym = mp.value || new Date().toISOString().slice(0,7);
      const [Y,M] = ym.split('-').map(Number);

      const first = new Date(Y, M-1, 1);
      const last  = new Date(Y, M, 0);

      document.getElementById('monthTitle').textContent = `${TH_MONTHS[M-1]} ${thYear(Y)}`;

      const firstDow = first.getDay();
      for(let i=0;i<firstDow;i++){
        const b=document.createElement('div');
        b.className='iosDay muted';
        b.innerHTML=`<div class="num"></div>`;
        grid.appendChild(b);
      }

      const mock = {
        3: [{cls:'ev-purple',icon:'üë©',text:'‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•16.30-18.30'},{cls:'ev-green',icon:'ü©∫',text:'Dr.Palmy'}],
        4: [{cls:'ev-green',icon:'ü©∫',text:'Dr.Palmy'}],
        6: [{cls:'ev-green',icon:'ü©∫',text:'Dr.Palmy'}],
        7: [{cls:'ev-purple',icon:'üë©',text:'‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•13.30-15.30'},{cls:'ev-green',icon:'ü©∫',text:'Dr.Palmy'}],
        8: [{cls:'ev-blue',icon:'üìò',text:'Dion 14.00-1...'}],
        11:[{cls:'ev-purple',icon:'üë©',text:'‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•16.30-18.30'},{cls:'ev-green',icon:'ü©∫',text:'Dr.Palmy'}],
        12:[{cls:'ev-brown',icon:'‚òï',text:'Cinder13.30'}],
      };

      for(let d=1; d<=last.getDate(); d++){
        const box=document.createElement('div');
        box.className='iosDay';
        box.onclick=()=>alert(`‡∏à‡∏±‡∏î‡πÄ‡∏ß‡∏£‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${d}/${M}/${thYear(Y)} (‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ú‡∏π‡∏Å modal)`);

        const ev=(mock[d]||[]).map(e=>`
          <div class="eventPill ${e.cls}" title="${escapeHtml(e.text)}">
            <span class="icon">${escapeHtml(e.icon)}</span>
            <span style="overflow:hidden;text-overflow:ellipsis">${escapeHtml(e.text)}</span>
          </div>
        `).join('');

        box.innerHTML = `<div class="num">${d}</div><div class="events">${ev}</div>`;
        grid.appendChild(box);
      }
    }

    // ---------------- Init ----------------
    (function init(){
      const today = new Date();
      const ymd = today.toISOString().slice(0,10);

      document.getElementById('dailyDate').value = ymd;
      applyDailyHeaderFromDate(ymd);
      renderDailyTable();

      document.getElementById('monthPicker').value = today.toISOString().slice(0,7);
      renderIOSCalendar();

      document.getElementById('dailyDate').addEventListener('change', (e)=>{
        applyDailyHeaderFromDate(e.target.value);
        renderDailyTable();
      });
      document.getElementById('monthPicker').addEventListener('change', ()=>renderIOSCalendar());
    })();
  </script>

  {% include "floating_menu.html" %}
</body>
</html>
